import React from 'react'
import { Link } from 'gatsby'

import withConnector from './Controller'

import Highlight from 'components/Highlight'

import { 
  SearchForm, SearchIcon, Input, RemoveBtn,
  Panel, NoResult, List, Item,
  AlgoliaLink, AlgoliaIcon } from './styled'

const SearchComponent = ({
  wrapRef,
  keyword, hits,
  onChangeToKeyword, reset,
}) => {
  return (
    <SearchForm action="" role="search" ref={wrapRef}>
      <SearchIcon viewBox="0 0 18 18">
        <path fillRule="evenodd" clipRule="evenodd" d="M14.312 12.897L17.707 16.293C18.098 16.684 18.098 17.316 17.707 17.707C17.512 17.902 17.256 18 17 18C16.744 18 16.488 17.902 16.293 17.707L12.897 14.312C11.543 15.365 9.846 16 8 16C3.589 16 0 12.411 0 8C0 3.589 3.589 0 8 0C12.411 0 16 3.589 16 8C16 9.846 15.365 11.543 14.312 12.897ZM8 2C4.691 2 2 4.691 2 8C2 11.309 4.691 14 8 14C11.309 14 14 11.309 14 8C14 4.691 11.309 2 8 2Z" />
      </SearchIcon>

      <Input
        type="search"
        value={keyword}
        onChange={onChangeToKeyword} />

      {keyword && <RemoveBtn onClick={reset}>
        <svg viewBox="0 0 18 18">
          <path fillRule="evenodd" clipRule="evenodd" d="M0 9C0 4.0374 4.0374 0 9 0C13.9626 0 18 4.0374 18 9C18 13.9626 13.9626 18 9 18C4.0374 18 0 13.9626 0 9ZM7.6225 9L5.32668 11.2958C5.32668 11.2958 4.61038 12.0121 5.29913 12.7009C5.98788 13.3896 6.70417 12.6733 6.70417 12.6733L9 10.3775L11.2958 12.6733C11.2958 12.6733 12.0121 13.3896 12.7009 12.7009C13.3896 12.0121 12.6733 11.2958 12.6733 11.2958L10.3775 9L12.6733 6.70417C12.6733 6.70417 13.3896 5.98787 12.7009 5.29913C12.0121 4.61038 11.2958 5.32668 11.2958 5.32668L9 7.6225L6.70417 5.32668C6.70417 5.32668 5.98788 4.61038 5.29913 5.29913C4.61038 5.98788 5.32668 6.70417 5.32668 6.70417L7.6225 9Z" />
        </svg>
      </RemoveBtn>}

      {keyword && (
        <Panel>
          {hits.length <= 0 ? (
            <NoResult>검색결과가 없습니다.</NoResult>
          ) : (
            <List>
              {hits.map(hit => (
                <Item key={hit.objectID} onClick={reset}>
                  <Link to={hit.fields.slug}>
                    <Highlight hit={hit} tagName="mark" attribute="frontmatter.title" />
                  </Link>
                </Item>
              ))}
            </List>
          )}

          <AlgoliaLink>
            <AlgoliaIcon viewBox="0 0 168 24">
              <path d="M6.97198 6.67703V8.30403C6.25998 7.85803 5.45198 7.63403 4.54698 7.63403C3.96198 7.63403 3.50198 7.76403 3.16698 8.02503C3.00663 8.14368 2.87727 8.29926 2.78987 8.47857C2.70248 8.65788 2.65964 8.85563 2.66498 9.05503C2.66498 9.48003 2.82898 9.82003 3.15898 10.075C3.48898 10.331 3.99398 10.607 4.67498 10.905C5.12198 11.097 5.46998 11.261 5.71998 11.4C5.96998 11.538 6.25698 11.732 6.58198 11.982C6.90598 12.232 7.14498 12.53 7.29998 12.876C7.45398 13.221 7.52998 13.617 7.52998 14.064C7.52998 15.011 7.19598 15.755 6.52598 16.298C5.85598 16.84 4.98898 17.112 3.92498 17.112C2.74498 17.112 1.76498 16.883 0.988978 16.426V14.718C1.82898 15.346 2.80298 15.66 3.90898 15.66C4.49398 15.66 4.95698 15.524 5.29698 15.253C5.63698 14.982 5.80698 14.607 5.80698 14.128C5.80698 13.841 5.70698 13.578 5.50498 13.338C5.30198 13.098 5.08498 12.918 4.84998 12.796C4.61598 12.673 4.26498 12.506 3.79698 12.293C3.60251 12.2037 3.4085 12.1134 3.21498 12.022C3.0295 11.9305 2.84612 11.8348 2.66498 11.735C2.46713 11.633 2.27755 11.5156 2.09798 11.384C1.94055 11.2574 1.78873 11.1239 1.64298 10.984C1.46298 10.814 1.33298 10.644 1.25298 10.474C1.17298 10.304 1.09798 10.104 1.02898 9.87603C0.958009 9.63516 0.922965 9.38513 0.924978 9.13403C0.924978 8.21903 1.25798 7.49603 1.92298 6.96403C2.58698 6.43203 3.44598 6.16603 4.49898 6.16603C5.46698 6.16603 6.29198 6.33603 6.97198 6.67603V6.67703ZM14.44 12.373V12.086C14.418 11.479 14.253 10.998 13.945 10.642C13.636 10.285 13.195 10.107 12.621 10.107C12.089 10.107 11.631 10.301 11.248 10.69C10.866 11.078 10.626 11.639 10.531 12.373H14.44ZM15.445 15.165V16.569C14.849 16.909 14.062 17.079 13.083 17.079C11.828 17.079 10.828 16.702 10.083 15.947C9.33898 15.192 8.96698 14.203 8.96698 12.979C8.96698 11.682 9.30698 10.663 9.98798 9.92403C10.668 9.18403 11.536 8.81403 12.588 8.81403C13.621 8.81403 14.44 9.13703 15.046 9.78003C15.652 10.424 15.956 11.352 15.956 12.564C15.956 12.894 15.923 13.24 15.86 13.602H10.546C10.653 14.304 10.951 14.841 11.44 15.213C11.93 15.585 12.546 15.771 13.29 15.771C14.152 15.771 14.87 15.569 15.445 15.165V15.165ZM22.05 13.395H20.838C20.242 13.395 19.793 13.511 19.489 13.745C19.186 13.979 19.035 14.277 19.035 14.639C19.035 15.011 19.152 15.303 19.385 15.516C19.62 15.729 19.96 15.836 20.407 15.836C20.917 15.836 21.319 15.694 21.611 15.412C21.904 15.131 22.051 14.761 22.051 14.304V13.394L22.05 13.395ZM17.982 10.841V9.32503C18.609 8.96403 19.439 8.78303 20.471 8.78303C22.587 8.78303 23.646 9.80903 23.646 11.863V17H22.098V16.043C21.683 16.723 20.955 17.063 19.912 17.063C19.146 17.063 18.532 16.843 18.069 16.402C17.607 15.96 17.375 15.399 17.375 14.718C17.375 13.942 17.668 13.338 18.253 12.908C18.838 12.477 19.657 12.261 20.71 12.261H22.05V11.8C22.05 11.246 21.917 10.829 21.651 10.547C21.385 10.265 20.944 10.124 20.327 10.124C19.4901 10.1166 18.6712 10.3673 17.982 10.842V10.841ZM27.315 8.91103V10.331C27.709 9.33103 28.416 8.83103 29.438 8.83103C29.586 8.83103 29.751 8.84703 29.932 8.87903V10.41C29.6944 10.3117 29.4391 10.263 29.182 10.267C28.64 10.267 28.193 10.507 27.842 10.985C27.491 11.464 27.315 12.033 27.315 12.692V17H25.752V8.91003H27.315V8.91103ZM32.325 12.995C32.347 13.815 32.597 14.487 33.075 15.014C33.554 15.54 34.225 15.804 35.085 15.804C35.724 15.804 36.32 15.628 36.873 15.277V16.681C36.352 17 35.687 17.16 34.878 17.16C33.613 17.16 32.602 16.76 31.847 15.963C31.092 15.165 30.714 14.171 30.714 12.979C30.714 11.819 31.094 10.828 31.854 10.004C32.615 9.17903 33.644 8.76703 34.942 8.76703C35.644 8.76703 36.288 8.91603 36.872 9.21403V10.65C36.3421 10.3177 35.7274 10.1458 35.102 10.155C34.262 10.155 33.589 10.421 33.083 10.953C32.578 11.485 32.325 12.166 32.325 12.995V12.995ZM40.24 5.72003V10.299C40.698 9.29903 41.533 8.79903 42.745 8.79903C43.532 8.79903 44.165 9.04403 44.644 9.53303C45.123 10.023 45.362 10.703 45.362 11.575V17H43.798V11.894C43.798 11.341 43.658 10.914 43.376 10.61C43.094 10.307 42.724 10.155 42.266 10.155C41.735 10.155 41.264 10.357 40.855 10.761C40.445 11.166 40.24 11.783 40.24 12.612V17H38.677V5.72003H40.24V5.72003ZM55.206 15.74C55.802 15.74 56.302 15.487 56.706 14.982C57.11 14.476 57.312 13.825 57.312 13.027C57.312 12.112 57.11 11.407 56.706 10.913C56.302 10.418 55.786 10.171 55.158 10.171C54.605 10.171 54.108 10.395 53.667 10.841C53.225 11.288 53.005 11.974 53.005 12.899C53.005 13.857 53.217 14.569 53.643 15.037C54.068 15.506 54.589 15.74 55.206 15.74ZM53.004 5.72003V10.14C53.578 9.24603 54.392 8.79903 55.444 8.79903C56.466 8.79903 57.301 9.18203 57.95 9.94803C58.599 10.714 58.923 11.729 58.923 12.995C58.923 14.133 58.614 15.104 57.998 15.907C57.381 16.71 56.535 17.112 55.461 17.112C54.386 17.112 53.567 16.665 53.004 15.772V17H51.424V5.72003H53.004ZM62.912 16.824L59.689 8.91103H61.428L62.433 11.543L63.693 14.958C63.789 14.638 64.173 13.5 64.843 11.543L65.752 8.91103H67.412L64.492 16.777C63.715 18.851 62.529 19.887 60.933 19.887C60.686 19.8919 60.4393 19.8653 60.199 19.808V18.468C60.369 18.51 60.55 18.532 60.742 18.532C61.774 18.532 62.497 17.962 62.912 16.824V16.824Z" />
              <path d="M78.966 1H95.56C96.3465 1.00053 97.1006 1.31319 97.6567 1.86931C98.2128 2.42543 98.5255 3.17953 98.526 3.966V20.562C98.5252 21.3482 98.2124 22.102 97.6563 22.6577C97.1002 23.2134 96.3462 23.5257 95.56 23.526H78.966C78.1798 23.5257 77.4258 23.2134 76.8697 22.6577C76.3136 22.102 76.0008 21.3482 76 20.562V3.959C76.0003 3.56991 76.0772 3.18468 76.2264 2.82534C76.3757 2.466 76.5943 2.13959 76.8697 1.86478C77.1452 1.58998 77.4721 1.37215 77.8318 1.22377C78.1915 1.07538 78.5769 0.999347 78.966 1V1Z" />
              <path d="M89.632 5.96702V5.19502C89.6317 4.93581 89.5286 4.68731 89.3452 4.50411C89.1618 4.32092 88.9132 4.21802 88.654 4.21802H86.374C86.1148 4.21802 85.8662 4.32092 85.6828 4.50411C85.4994 4.68731 85.3963 4.93581 85.396 5.19502V5.98802C85.396 6.07602 85.478 6.13802 85.567 6.11802C86.2118 5.93172 86.8798 5.83746 87.551 5.83802C88.201 5.83802 88.846 5.92602 89.468 6.09702C89.55 6.11702 89.632 6.05702 89.632 5.96702V5.96702ZM83.384 6.97702L82.994 6.58802C82.9033 6.49725 82.7955 6.42524 82.677 6.37612C82.5584 6.32699 82.4313 6.3017 82.303 6.3017C82.1747 6.3017 82.0476 6.32699 81.929 6.37612C81.8104 6.42524 81.7027 6.49725 81.612 6.58802L81.147 7.05302C81.056 7.14344 80.9839 7.25095 80.9346 7.36937C80.8854 7.48779 80.86 7.61477 80.86 7.74302C80.86 7.87127 80.8854 7.99825 80.9346 8.11667C80.9839 8.23508 81.056 8.34259 81.147 8.43302L81.53 8.81602C81.592 8.87702 81.68 8.86302 81.735 8.80202C81.961 8.49502 82.207 8.20102 82.481 7.92802C82.762 7.64802 83.049 7.40202 83.364 7.17702C83.432 7.13502 83.439 7.04002 83.384 6.97702V6.97702ZM87.544 9.43002V12.771C87.544 12.867 87.648 12.936 87.736 12.888L90.706 11.351C90.774 11.317 90.795 11.234 90.761 11.167C90.4494 10.6191 90.0028 10.16 89.4637 9.8334C88.9246 9.50679 88.3109 9.32352 87.681 9.30102C87.613 9.30102 87.545 9.35502 87.545 9.43102L87.544 9.43002ZM87.545 17.479C86.3555 17.4793 85.2145 17.0074 84.3726 16.1671C83.5308 15.3267 83.0568 14.1865 83.055 12.997C83.0566 11.8074 83.5304 10.6671 84.3723 9.8267C85.2142 8.98627 86.3554 8.51449 87.545 8.51502C88.7344 8.51475 89.8753 8.98665 90.717 9.82705C91.5587 10.6674 92.0324 11.8076 92.034 12.997C92.0337 13.5862 91.9174 14.1696 91.6915 14.7137C91.4657 15.2579 91.1348 15.7523 90.7178 16.1685C90.3008 16.5848 89.8059 16.9147 89.2613 17.1396C88.7167 17.3645 88.1332 17.4798 87.544 17.479H87.545ZM87.544 6.62902C85.856 6.62902 84.2372 7.29956 83.0436 8.49314C81.85 9.68671 81.1795 11.3055 81.1795 12.9935C81.1795 14.6815 81.85 16.3003 83.0436 17.4939C84.2372 18.6875 85.856 19.358 87.544 19.358C88.3805 19.3583 89.2089 19.1938 89.9818 18.8739C90.7548 18.554 91.4572 18.085 92.0489 17.4937C92.6405 16.9024 93.11 16.2003 93.4303 15.4276C93.7507 14.6548 93.9157 13.8265 93.916 12.99C93.9163 12.1538 93.7516 11.3258 93.4314 10.5533C93.1111 9.78083 92.6417 9.07912 92.0499 8.48834C91.4581 7.89756 90.7556 7.42933 89.9826 7.11045C89.2095 6.79157 88.3812 6.62831 87.545 6.63002" />
              <path d="M120.925 18.8041C116.539 18.8241 116.539 15.2641 116.539 14.6981L116.532 1.36205L119.207 0.938049V14.1921C119.207 14.5141 119.207 16.5501 120.925 16.5561V18.8041ZM110.079 16.6241C110.9 16.6241 111.509 16.5771 111.934 16.4951V13.7761C111.42 13.644 110.891 13.5772 110.36 13.5771C110.06 13.5764 109.76 13.5995 109.463 13.6461C109.181 13.6826 108.906 13.7636 108.649 13.8861C108.409 14.0021 108.21 14.1661 108.067 14.3771C107.917 14.5891 107.848 14.7121 107.848 15.0331C107.848 15.6611 108.067 16.0241 108.464 16.2631C108.861 16.5021 109.402 16.6241 110.079 16.6241ZM109.846 6.92405C110.729 6.92405 111.475 7.03305 112.077 7.25205C112.679 7.47005 113.165 7.77705 113.521 8.16705C113.884 8.56305 114.13 9.08905 114.281 9.65005C114.438 10.2101 114.513 10.8251 114.513 11.5001V18.3741C113.894 18.4968 113.271 18.6016 112.645 18.6881C111.811 18.8111 110.873 18.8731 109.832 18.8731C109.142 18.8731 108.505 18.8041 107.937 18.6751C107.409 18.5644 106.908 18.3481 106.466 18.0391C106.062 17.7438 105.735 17.3546 105.515 16.9051C105.289 16.4401 105.172 15.7851 105.172 15.1021C105.172 14.4461 105.302 14.0291 105.556 13.5771C105.812 13.1304 106.171 12.7513 106.603 12.4711C107.048 12.1841 107.553 11.9791 108.135 11.8561C108.734 11.7313 109.344 11.6693 109.955 11.6711C110.62 11.6728 111.281 11.7534 111.927 11.9111V11.4731C111.927 11.1661 111.892 10.8731 111.817 10.5991C111.745 10.3303 111.613 10.081 111.433 9.86905C111.236 9.64711 110.988 9.47766 110.709 9.37605C110.344 9.23779 109.956 9.16828 109.566 9.17105C108.95 9.17105 108.389 9.24605 107.876 9.33505C107.448 9.40193 107.027 9.50463 106.616 9.64205L106.295 7.45005C106.63 7.33305 107.129 7.21705 107.773 7.10105C108.457 6.97623 109.151 6.91763 109.846 6.92405ZM162.688 16.5501C163.51 16.5501 164.118 16.5021 164.542 16.4201V13.7001C164.028 13.5681 163.499 13.5013 162.968 13.5011C162.674 13.5011 162.373 13.5221 162.072 13.5701C161.79 13.6066 161.515 13.6876 161.258 13.8101C161.024 13.9194 160.823 14.0888 160.676 14.3011C160.526 14.5131 160.458 14.6361 160.458 14.9571C160.458 15.5851 160.676 15.9481 161.073 16.1871C161.477 16.4321 162.011 16.5501 162.688 16.5501ZM162.462 6.85605C163.345 6.85605 164.091 6.96405 164.693 7.18305C165.295 7.40205 165.781 7.70905 166.137 8.09805C166.492 8.48805 166.746 9.02105 166.896 9.58105C167.058 10.1847 167.137 10.8079 167.129 11.4331V18.3061C166.719 18.3941 166.095 18.4961 165.261 18.6201C164.427 18.7431 163.489 18.8041 162.448 18.8041C161.758 18.8041 161.121 18.7361 160.553 18.6061C160.025 18.4957 159.525 18.2797 159.082 17.9711C158.678 17.6758 158.351 17.2866 158.131 16.8371C157.905 16.3721 157.788 15.7171 157.788 15.0331C157.788 14.3771 157.918 13.9601 158.172 13.5091C158.432 13.0591 158.78 12.6891 159.219 12.4021C159.664 12.1161 160.169 11.9111 160.751 11.7881C161.656 11.6007 162.584 11.5568 163.502 11.6581C163.831 11.6921 164.173 11.7541 164.542 11.8431V11.4061C164.545 11.1108 164.508 10.8165 164.433 10.5311C164.361 10.2619 164.23 10.0121 164.049 9.80005C163.852 9.57847 163.603 9.40938 163.325 9.30805C162.96 9.16981 162.572 9.10031 162.182 9.10305C161.566 9.10305 161.005 9.17805 160.492 9.26705C160.064 9.334 159.643 9.43669 159.232 9.57405L158.911 7.38105C159.246 7.26505 159.745 7.14905 160.389 7.03305C161.073 6.91225 161.767 6.85302 162.462 6.85605ZM154.428 5.58505C153.997 5.58558 153.584 5.41533 153.279 5.11163C152.974 4.80794 152.802 4.3956 152.8 3.96505C152.8 3.07005 153.525 2.34505 154.428 2.34505C155.332 2.34505 156.058 3.07005 156.058 3.96505C156.058 4.86005 155.325 5.58505 154.428 5.58505ZM155.776 18.8051H153.087V7.27005L155.777 6.84705V18.8031L155.776 18.8051ZM151.062 18.8051C146.676 18.8251 146.676 15.2651 146.676 14.6981L146.668 1.36205L149.344 0.938049V14.1921C149.344 14.5141 149.344 16.5501 151.062 16.5561V18.8051ZM142.364 12.9021C142.364 11.7461 142.111 10.7831 141.618 10.1141C141.125 9.43705 140.435 9.10405 139.551 9.10405C138.669 9.10405 137.977 9.43705 137.486 10.1141C136.993 10.7901 136.753 11.7461 136.753 12.9021C136.753 14.0701 136.999 14.8551 137.493 15.5321C137.985 16.2151 138.676 16.5501 139.559 16.5501C140.441 16.5501 141.133 16.2081 141.626 15.5311C142.118 14.8481 142.364 14.0711 142.364 12.9011V12.9021ZM145.101 12.8951C145.101 13.7971 144.971 14.4791 144.704 15.2251C144.461 15.9301 144.077 16.5784 143.576 17.1311C143.087 17.6605 142.49 18.0778 141.824 18.3541C141.139 18.6401 140.085 18.8041 139.559 18.8041C139.031 18.7981 137.985 18.6471 137.307 18.3541C136.646 18.0738 136.052 17.657 135.563 17.1311C135.076 16.6041 134.7 15.9691 134.426 15.2251C134.144 14.481 134.005 13.6906 134.016 12.8951C134.016 11.9931 134.139 11.1251 134.413 10.3871C134.665 9.68559 135.057 9.04214 135.563 8.49505C136.055 7.97176 136.651 7.5575 137.313 7.27905C137.992 6.99205 138.738 6.85605 139.545 6.85605C140.353 6.85605 141.098 6.99805 141.782 7.27905C142.449 7.55013 143.048 7.96538 143.535 8.49505C144.034 9.04491 144.42 9.68786 144.67 10.3871C144.957 11.1251 145.101 11.9931 145.101 12.8951ZM124.963 12.8951C124.963 14.0151 125.209 15.2581 125.701 15.7771C126.194 16.2971 126.831 16.5571 127.611 16.5571C128.035 16.5571 128.439 16.4951 128.815 16.3791C129.192 16.2631 129.492 16.1261 129.732 15.9621V9.33005C129.151 9.20474 128.56 9.12913 127.966 9.10405C126.995 9.07605 126.256 9.47405 125.736 10.1081C125.223 10.7441 124.963 11.8571 124.963 12.8951ZM132.401 18.1691C132.401 19.9931 131.935 21.3251 130.997 22.1731C130.061 23.0191 128.63 23.4431 126.701 23.4431C125.996 23.4431 124.531 23.3061 123.361 23.0471L123.792 20.9291C124.772 21.1341 126.064 21.1891 126.742 21.1891C127.816 21.1891 128.582 20.9701 129.041 20.5331C129.5 20.0961 129.725 19.4471 129.725 18.5851V18.1481C129.386 18.3045 129.036 18.4371 128.678 18.5451C128.248 18.6751 127.748 18.7431 127.186 18.7431C126.447 18.7431 125.776 18.6271 125.168 18.3941C124.575 18.1745 124.04 17.8241 123.601 17.3691C123.17 16.9191 122.827 16.3521 122.588 15.6751C122.348 14.9981 122.225 13.7901 122.225 12.9021C122.225 12.0681 122.355 11.0221 122.609 10.3251C122.869 9.62905 123.238 9.02705 123.738 8.52905C124.231 8.03105 124.833 7.64805 125.538 7.36705C126.311 7.06336 127.135 6.90831 127.966 6.91005C128.836 6.91005 129.636 7.01905 130.416 7.15005C131.196 7.27905 131.86 7.41505 132.401 7.56505V18.1691Z" />
            </AlgoliaIcon>
          </AlgoliaLink>
        </Panel>)}
    </SearchForm>
  )
}

export default withConnector(SearchComponent)
